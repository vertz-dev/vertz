---
title: Authentication
description: Add user authentication to your Vertz app
---

# Step 3: Authentication

Let's add user authentication using @vertz/server's built-in auth module.

## Configure Auth

Create `src/server/auth.ts`:

```typescript
import { createAuth } from '@vertz/server';

export const auth = createAuth({
  // Use email/password authentication
  providers: {
    emailPassword: {
      // Password requirements
      password: {
        minLength: 8,
        requireUppercase: true,
        requireNumbers: true,
      },
    },
  },
  
  // Session configuration
  session: {
    expiresIn: 60 * 60 * 24 * 7, // 7 days
    cookieName: 'vertz-session',
  },
  
  // Rate limiting
  rateLimit: {
    windowMs: 15 * 60 * 1000, // 15 minutes
    max: 10, // 10 attempts
  },
});
```

## Create Auth Router

Create `src/server/routers/auth.ts`:

```typescript
import { router, procedure } from '@vertz/server';
import { auth } from '../auth';

export const authRouter = router({
  // User registration
  signup: procedure
    .input(z.object({
      email: z.string().email(),
      password: z.string(),
      name: z.string(),
    }))
    .mutation(async ({ input }) => {
      const result = await auth.signUp({
        email: input.email,
        password: input.password,
        metadata: { name: input.name },
      });
      
      return { userId: result.userId };
    }),
  
  // User login
  signin: procedure
    .input(z.object({
      email: z.string().email(),
      password: z.string(),
    }))
    .mutation(async ({ input }) => {
      const result = await auth.signIn({
        email: input.email,
        password: input.password,
      });
      
      return { sessionId: result.sessionId };
    }),
  
  // Get current user
  me: procedure
    .query(async ({ ctx }) => {
      if (!ctx.user) {
        return null;
      }
      
      return {
        id: ctx.user.id,
        email: ctx.user.email,
        name: ctx.user.metadata.name,
      };
    }),
  
  // Sign out
  signout: procedure
    .mutation(async ({ ctx }) => {
      await auth.signOut(ctx.sessionId);
      return { success: true };
    }),
});
```

## Protect Routes

Add middleware to protect routes:

```typescript
import { middleware } from '@vertz/server';

const withAuth = middleware(async ({ ctx, next }) => {
  if (!ctx.user) {
    throw new UnauthorizedException('Must be logged in');
  }
  return next({ ctx });
});

const protectedProcedure = procedure.use(withAuth);
```

## Next Steps

Now let's build the API in [Step 4: Building the API](/tutorial/api).
