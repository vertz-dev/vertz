# Audit: docs: add core principles (determinism, fail fast) + Turborepo migration plan

**Date:** 2026-02-14 | **Agent:** mike (vertz-tech-lead) | **PR:** #270 | **Grade:** D

**Summary:** Valuable documentation additions (core principles + Turborepo migration plan), but **critical process violation**: bundled an audit report (PR #262 audit) with unrelated documentation work in the same PR. The auditor soul explicitly requires audit PRs to be isolated in their own worktrees and PRs to prevent polluted diffs. Additionally, no ticket referenced, and git identity confusion (commits authored by "kai" but PR opened by "vertz-tech-lead").

---

## TDD Compliance: N/A

This is a documentation-only PR with no code implementation.

---

## Git & PR Process: ❌ (Grade: F)

### ❌ CRITICAL: Scope creep — bundled audit report with unrelated docs

**Evidence:**
- PR #270 contains TWO commits:
  1. Commit 85b196bb3fa (14:09:50): "audit: PR #262 task-manager SSR implementation (Grade: C)"
     - Adds `plans/audits/2026-02-14-pr262-kai.md` (332 lines)
     - Adds `plans/audits/data/2026-02-14-pr262-kai.json` (204 lines)
  2. Commit 31d2a0d7fe7 (16:18:46): "docs: add core principles + Turborepo migration plan"
     - Modifies `RULES.md` (10 lines added)
     - Adds `plans/turborepo-migration.md` (221 lines)
- These are **completely unrelated** pieces of work bundled into one PR

**Why this matters:**

The auditor soul (`/workspace/backstage/openclaw/souls/auditor.md`) explicitly states:

> **⚠️ Creating Audit PRs — Worktree Isolation (MANDATORY)**
>
> When you open a PR to publish your audit report, you **MUST** use an isolated git worktree. This prevents your audit branch from picking up uncommitted changes from other features.
>
> **Never create an audit branch from the main repo working directory.** If you do, you risk including staged/unstaged changes from other agents' work — this has caused polluted PRs before.

This is EXACTLY what happened. The audit for PR #262 was bundled with unrelated documentation work (core principles + Turborepo plan), creating a polluted PR.

**RULES.md** also states:
> "Don't refactor unrelated code. Stay in scope."
> "Scope creep is the #1 agent failure mode."

**Recommendation:**
Split into TWO separate PRs:
1. **PR for audit report:** `audit/pr262-kai` branch with ONLY the audit files
2. **PR for core principles + Turborepo:** `docs/core-principles-turborepo` branch with ONLY RULES.md + turborepo-migration.md

Use `git worktree add` for the audit PR to ensure isolation.

---

### ❌ MAJOR: Audit PR isolation violated

**Evidence:**
- The audit report files (plans/audits/...) were committed in the same branch as other documentation work
- No evidence of worktree isolation (`git worktree list` shows no audit-specific worktree for this PR)
- Branch name is `docs/core-principles-turborepo` (generic docs branch, not audit-specific)

**Why this matters:**

From auditor.md:
```bash
# 1. Create a clean worktree from main
git worktree add /tmp/worktrees/audit-pr262 -b audit/pr262-kai main

# 2. Work inside it
cd /tmp/worktrees/audit-pr262

# 3. Add ONLY audit files
mkdir -p plans/audits/data
cp <your-report>.md plans/audits/
cp <your-data>.json plans/audits/data/

# 4. Commit and push from the worktree
git add plans/audits/
git commit -m "audit: PR #262 (kai) - Grade C"
git push origin audit/pr262-kai
```

This workflow was NOT followed. Instead, the audit files were added to a docs branch alongside other work.

**Recommendation:**
Always use isolated worktrees for audit PRs. This is a **MANDATORY** requirement per auditor.md.

---

### ❌ MAJOR: Git identity confusion

**Evidence:**
- PR opened by: `app/vertz-tech-lead` (mike's bot account)
- Commits authored by: `kai <kai@vertz.dev>`
- Both commits show "Author: kai" but were pushed under vertz-tech-lead's PR

**Why this matters:**
RULES.md requires:
> "Check `AGENT_BOT` env var to know who you are"
> "All git/GitHub ops through bot scripts — never use personal credentials"

If mike (vertz-tech-lead) is opening the PR, commits should be authored by mike or the vertz-tech-lead bot. If kai did the work, kai's bot should open the PR.

**Recommendation:**
- Use `/workspace/backstage/bots/git-as.sh $AGENT_BOT` for git operations
- Use `/workspace/backstage/bots/gh-as.sh $AGENT_BOT` for GitHub operations
- Ensure git author matches the agent doing the work

---

### ❌ MAJOR: No ticket referenced

**Evidence:**
- PR description does not reference a ticket
- Commits do not reference a ticket
- No ticket found in `/workspace/vertz/tickets/` for this work

**Why this matters:**
RULES.md states:
> "Never commit without a ticket"

Documentation work, even simple additions, should be tracked:
- Who requested it?
- Why is it needed?
- What problem does it solve?

**Recommendation:**
Before implementing:
1. Check if ticket exists
2. If not, create ticket stub in `tickets/`
3. Reference in commits: `docs: add core principles (closes #XXX)`

---

### ✅ Branch created before work

- Feature branch used: `docs/core-principles-turborepo`
- Proper PR process followed (not direct push to main)

---

### ✅ Bot script used for PR

- PR opened via proper bot identity (vertz-tech-lead)

---

### ❌ MINOR: Non-atomic commits

**Evidence:**
- Commit 85b196bb3fa adds 536 lines (audit report + JSON)
- Commit 31d2a0d7fe7 adds 231 lines (RULES.md + turborepo plan)
- The second commit bundles TWO changes: core principles AND Turborepo plan

**Recommendation:**
Split commit 2 into:
1. `docs: add core principles (determinism, fail fast) to RULES.md`
2. `docs: add Turborepo migration plan`

Keep commits atomic — one logical change per commit.

---

## Design Compliance: ⚠️ (Grade: C)

### ❌ No ticket or design doc

**Evidence:**
- No ticket in `/workspace/vertz/tickets/`
- No reference in PR description

**Why this matters:**
Even for documentation work, tickets provide:
- Context (who needs this, why)
- Acceptance criteria
- Traceability

**Recommendation:**
Create tickets for all work, including docs.

---

### ✅ RULES.md read (evidence suggests)

- The changes to RULES.md are well-placed and follow existing structure
- Turborepo migration plan references correct process files

---

### ⚠️ Scope creep (already covered above)

---

## DX & Quality: ✅ (Grade: A)

### ✅ Excellent documentation quality

**Core Principles addition:**
- Clear, concise definitions
- Well-placed in RULES.md (after The Four Laws, before Quick Reference)
- Strong rationale provided for each principle
- Actionable guidance (not just platitudes)

**Turborepo migration plan:**
- Comprehensive and well-structured
- Clear "Context" section explaining the problem
- Detailed implementation steps with code examples
- Success criteria defined
- Rollback plan included
- "Adding a New Package" checklist is valuable

---

### ✅ Clear and actionable

Both documents are immediately usable:
- Engineers can follow the Turborepo migration step-by-step
- Core principles provide clear decision-making frameworks

---

### ✅ Proper formatting

- Markdown is clean and well-formatted
- Code blocks are properly annotated with language hints
- Headers are properly nested
- Tables are used appropriately

---

## Security: N/A

Documentation-only PR, no security implications.

---

## Audit Report Quality (Meta-Audit)

### ✅ PR #262 audit report is thorough

**Positive aspects:**
- Comprehensive evidence with commit hashes and timestamps
- Clear severity levels (CRITICAL, MAJOR, MINOR)
- Actionable recommendations
- Good balance of criticism and praise ("Positive Highlights" section)
- Follows auditor.md template structure

### ✅ Structured JSON data included

- `plans/audits/data/2026-02-14-pr262-kai.json` follows schema
- Machine-readable format for trend analysis
- Proper severity levels and evidence fields

### ⚠️ Audit delivered in wrong PR

As noted above, the audit should have been its own isolated PR, not bundled with other work.

---

## Positive Highlights

1. **High-quality content:** Both the core principles and Turborepo plan are valuable additions
2. **Thorough Turborepo plan:** Addresses determinism concerns with specific solution
3. **Comprehensive audit of PR #262:** Well-structured, evidence-based, constructive feedback
4. **Clear writing:** All documentation is readable and actionable
5. **Proper JSON audit data:** Follows schema for machine-readable tracking

---

## Critical Violations Summary

| Rule | Severity | Issue |
|------|----------|-------|
| Audit PR isolation | **CRITICAL** | Audit report bundled with unrelated docs, violating mandatory worktree isolation |
| Scope control | **CRITICAL** | Two unrelated pieces of work in one PR (audit + core principles + Turborepo plan) |
| Ticket required | **MAJOR** | No ticket referenced for any of the work |
| Git identity | **MAJOR** | Commits authored by "kai" but PR opened by "vertz-tech-lead" |
| Atomic commits | **MINOR** | Second commit bundles two changes (core principles + Turborepo) |

---

## Recommendations

### Immediate (for next audit PR)

1. **ALWAYS use isolated worktree for audit PRs:**
   ```bash
   git worktree add /tmp/worktrees/audit-pr<N> -b audit/pr<N>-<agent> main
   cd /tmp/worktrees/audit-pr<N>
   # Add ONLY audit files
   git add plans/audits/
   git commit -m "audit: PR #<N> (<agent>) - Grade <X>"
   ```

2. **One PR per logical unit:**
   - Audit reports: separate PR
   - Documentation changes: separate PR
   - Never bundle unrelated work

3. **Always reference tickets:**
   - Create ticket stubs if needed
   - Reference in commits and PR description

4. **Use correct git identity:**
   - `/workspace/backstage/bots/git-as.sh $AGENT_BOT`
   - Ensure author matches agent doing the work

### Process improvements

1. **Checklist before opening PR:**
   - [ ] Is this work isolated and focused? (no scope creep)
   - [ ] Is audit work in its own worktree?
   - [ ] Is ticket referenced?
   - [ ] Is git identity correct?
   - [ ] Are commits atomic?

2. **Audit PRs are special:**
   - They MUST be isolated (worktree + separate PR)
   - This is non-negotiable per auditor.md
   - Prevents audit pollution from other work

### Long-term

1. **Internalize worktree discipline:** Make it muscle memory for audits
2. **Ticket-first culture:** Don't start work without a ticket
3. **Git identity hygiene:** Always verify `$AGENT_BOT` matches commit author

---

## Final Grade: D

**Rationale:**
- **Content quality:** A (excellent documentation, valuable additions)
- **Git & PR process:** F (critical violations: audit isolation, scope creep, git identity)
- **Design compliance:** C (no ticket)
- **DX & Quality:** A (clear, actionable, well-structured)
- **Security:** N/A

**Overall:** The content itself is excellent and valuable. However, **critical process violations** (bundling audit with unrelated work, violating mandatory worktree isolation for audits, no ticket, git identity confusion) result in a failing grade.

**This is a learning opportunity:** The process violations are serious enough that the PR should have been split and re-submitted as two separate PRs. The auditor soul's requirements for isolated audit PRs exist to prevent exactly this kind of pollution.

**Key lesson:** Process discipline protects quality. Even excellent content can't salvage a PR that violates fundamental process rules.

---

## Flag to Main Session

**Grade: D (< B threshold)**

**Action required:** Discuss with mike (vertz-tech-lead) and kai:
1. Why was the audit bundled with other docs?
2. Review auditor.md worktree isolation requirements
3. Establish clearer process for audit PR creation
4. Reinforce "one PR per logical unit" discipline

**Recommendation:** Retroactively split this PR in git history (if feasible) or document as "what not to do" example in auditor training materials.
